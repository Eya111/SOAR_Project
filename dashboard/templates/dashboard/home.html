{% extends "base.html" %}

{% block content %}

<div class="card soft-shadow">


<h2 class="mb-4">
    üõ°Ô∏è SOAR ‚Äì Vue globale
</h2>

<div class="mb-4">
    <a href="{% url 'run_demo' %}" class="btn btn-primary">
        ‚ñ∂Ô∏è Lancer la d√©mo automatique
    </a>
</div>

<div class="mb-4">
    <a href="{% url 'export_logs' %}" class="btn btn-success">
        üìÑ Exporter les logs CSV
    </a>
</div>


<div class="row g-4">

    <div class="col-md-3">
        <div class="card text-bg-dark shadow">
            <div class="card-body">
                <h6>Total √©v√©nements</h6>
                <h2>{{ total_events }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-bg-danger shadow">
            <div class="card-body">
                <h6>HIGH</h6>
                <h2>{{ high_events }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-bg-warning shadow">
            <div class="card-body">
                <h6>MEDIUM</h6>
                <h2>{{ medium_events }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-bg-success shadow">
            <div class="card-body">
                <h6>LOW</h6>
                <h2>{{ low_events }}</h2>
            </div>
        </div>
    </div>

</div>

<hr class="my-4">

<div class="row g-4">

    <div class="col-md-4">
        <div class="card border-warning shadow">
            <div class="card-body">
                <h6>‚ö° Triggers d√©clench√©s</h6>
                <h2>{{ triggers_fired }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-success shadow">
            <div class="card-body">
                <h6>‚úÖ Playbooks SUCCESS</h6>
                <h2>{{ success_runs }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-danger shadow">
            <div class="card-body">
                <h6>‚ùå Playbooks FAILED</h6>
                <h2>{{ failed_runs }}</h2>
            </div>
        </div>
    </div>

</div>

<hr class="my-5">

<div class="row g-4">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-body">
                <h5 class="text-center">üìä S√©v√©rit√© des √©v√©nements</h5>
                <canvas id="severityChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-body">
                <h5 class="text-center">‚ö° Playbooks</h5>
                <canvas id="playbookChart"></canvas>
            </div>
        </div>
    </div>
</div>


<script>
  // Refresh toutes les 5 secondes (5000 ms)
  setTimeout(function(){
     location.reload();
  }, 5000);
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {

    const severityCtx = document.getElementById('severityChart');
    if (severityCtx) {
        new Chart(severityCtx, {
            type: 'doughnut',
            data: {
                labels: ['HIGH', 'MEDIUM', 'LOW'],
                datasets: [{
                    data: {{ severity_data|safe }},
                    backgroundColor: ['#dc3545', '#ffc107', '#198754']
                }]
            }
        });
    }

    const playbookCtx = document.getElementById('playbookChart');
    if (playbookCtx) {
        new Chart(playbookCtx, {
            type: 'bar',
            data: {
                labels: ['SUCCESS', 'FAILED'],
                datasets: [{
                    data: {{ playbook_data|safe }},
                    backgroundColor: ['#198754', '#dc3545']
                }]
            }
        });
    }

});
</script>


<hr class="my-5">

<h4 class="text-center mb-4">üß† Pipeline SOAR ‚Äì Fonctionnement</h4>

<div class="d-flex justify-content-between align-items-center text-center">

    <div class="p-3">
        <div class="badge bg-secondary fs-6">üì• √âv√©nement</div>
        <p class="small mt-2">Incident d√©tect√©</p>
    </div>

    <div class="fs-3">‚û°Ô∏è</div>

    <div class="p-3">
        <div class="badge bg-info fs-6">üß† Analyse</div>
        <p class="small mt-2">√âvaluation s√©v√©rit√©</p>
    </div>

    <div class="fs-3">‚û°Ô∏è</div>

    <div class="p-3">
        <div class="badge bg-warning fs-6">‚ö° Trigger</div>
        <p class="small mt-2">Condition v√©rifi√©e</p>
    </div>

    <div class="fs-3">‚û°Ô∏è</div>

    <div class="p-3">
        <div class="badge bg-danger fs-6">üõ†Ô∏è Playbook</div>
        <p class="small mt-2">Action automatique</p>
    </div>

    <div class="fs-3">‚û°Ô∏è</div>

    <div class="p-3">
        <div class="badge bg-success fs-6">üìú Log</div>
        <p class="small mt-2">Tra√ßabilit√© compl√®te</p>
    </div>

</div>



{% endblock %}
